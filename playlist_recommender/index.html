<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Spotify PKCE Demo</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;margin:0;background:#f5f7fa;}
    .btn{padding:0.8rem 1.6rem;font-size:1.1rem;border:none;border-radius:6px;background:#1db954;color:#fff;cursor:pointer;}
    .btn:hover{opacity:0.9;}
  </style>
</head>
<body>
  <h1>Spotify Authorization Code Flow with PKCE</h1>
  <button id="loginBtn" class="btn">Spotify でログイン</button>

  <script type="module">
    import { createPKCE } from './pkce.js';

    const clientId = '89175f465b5d42c9aac789c37cf8d730';
    const redirectUri = 'https://yamasan61.github.io/spotify-token-test/playlist_recommender/callback.html';
    const scope = 'user-read-private';

    document.getElementById('loginBtn').addEventListener('click', async () => {
      const { verifier, challenge } = await createPKCE();
      sessionStorage.setItem('code_verifier', verifier);

      const params = new URLSearchParams({
        client_id: clientId,
        response_type: 'code',
        redirect_uri: redirectUri,
        scope,
        code_challenge_method: 'S256',
        code_challenge: challenge,
        show_dialog: 'true'
      });

      // リダイレクト
      window.location.href = `https://accounts.spotify.com/authorize?${params.toString()}`;
    });
  </script>
</body>
</html>
